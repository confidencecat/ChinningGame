# 턱걸이 플래피 버드 (Chin-up Flappy Bird)

턱걸이 동작으로 조작하는 플래피 버드 게임이다. MediaPipe를 사용하여 실시간 포즈 인식을 통해 게임을 제어한다.

## 프로젝트 개요

운동에 흥미(경쟁 심리)를 주기 위해서 제작한 프로젝트이다.키보드나 마우스 대신 웹캠을 통해 플레이어의 어깨 위치를 감지하여 새의 높이를 제어한다. 플레이어가 턱걸이를 하면 새가 위로 올라가고, 팔을 내리면 새가 아래로 내려간다.

[이전 모션 게임](https://github.com/DaegunManga/motion-game)의 업그레이드 버전

## 주요 기능

- **실시간 포즈 인식**: MediaPipe를 사용하여 플레이어의 어깨 좌표를 실시간으로 감지한다
- **듀얼 윈도우**: 게임 화면과 카메라 피드를 별도 창으로 표시한다
- **랭킹 시스템**: 점수를 JSON 파일에 저장하고 상위 5명의 점수를 표시한다
- **점진적 난이도**: 파이프를 통과할 때마다 게임 속도가 증가한다
- **3가지 게임 상태**: 로비, 게임 플레이, 게임 오버 화면을 제공한다

## 설치 방법

1. 가상환경 생성 및 활성화:
```powershell
python -m venv venv
.venv\Scripts\Activate.ps1
```

2. 필요한 패키지 설치:
```powershell
pip install pygame opencv-python mediapipe numpy
```

## 실행 방법

### 기본 실행 (카메라 인덱스 0 사용):
```powershell
python main.py
```

### 특정 카메라 사용:
```powershell
python main.py --cam 1
```

## 파일 구조 및 설명

### config.py
게임의 모든 설정과 상수를 관리하는 파일이다.

**주요 설정값:**
- `GAME_WIDTH, GAME_HEIGHT`: 게임 창 크기 (1200x800)
- `PIPE_GAP`: 파이프 간의 간격 (280픽셀)
- `PIPE_SPEED`: 파이프 이동 속도 (초기값 5)
- `SPEED_INCREASE`: 파이프 통과 시 속도 증가량 (0.2)
- `MAX_ID_LENGTH`: 플레이어 ID 최대 길이 (5글자)

**색상 정의:**
- 다양한 UI 요소에 사용되는 RGB 색상값들을 정의한다
- 골드, 실버, 사이버 블루 등 게임 테마에 맞는 색상들을 포함한다

### player.py
플레이어 캐릭터와 포즈 인식 기능을 담당하는 핵심 클래스다.

**Player 클래스의 주요 메서드:**

#### `__init__(self, x, y)`
- 플레이어 초기 위치 설정 및 MediaPipe 포즈 모델 초기화
- 새 이미지 로드 (bird_850x594.png를 50x50 크기로 리사이징)
- 이미지 로드 실패 시 노란색 사각형으로 대체

#### `init_camera(self, camera_index)`
- 지정된 인덱스의 카메라를 초기화한다
- 카메라 해상도를 640x480으로 설정한다
- 초기화 성공 시 True, 실패 시 False 반환

#### `update_pose(self)`
- 카메라에서 프레임을 읽어온다
- BGR을 RGB로 변환하고 MediaPipe로 포즈를 인식한다
- 좌우 어깨의 중점을 계산하여 게임 좌표계로 변환한다
- 부드러운 움직임을 위해 이전 위치와 현재 위치를 0.8:0.2 비율로 보간한다
- 감지된 포즈에 랜드마크를 그려서 반환한다

#### `update(self)`
- 포즈가 감지되면 어깨 위치에 따라 플레이어 위치 조정
- 포즈가 감지되지 않으면 중력 물리학 적용
- 화면 경계를 벗어나지 않도록 위치 제한

#### `draw(self, screen)`
- 플레이어 이미지를 화면에 그린다
- 포즈 감지 상태를 나타내는 원형 인디케이터 표시 (녹색: 감지됨, 빨간색: 미감지)

### pipe.py
게임의 장애물인 파이프를 관리하는 클래스다.

**Pipe 클래스의 주요 메서드:**

#### `__init__(self, x)`
- 파이프의 x 좌표와 랜덤한 높이를 설정한다
- 상단과 하단 파이프의 충돌 감지용 Rectangle 생성
- 파이프 높이는 100~(화면높이-간격-100) 사이에서 랜덤 결정

#### `update(self, speed)`
- 파이프를 왼쪽으로 이동시킨다
- 충돌 감지용 Rectangle의 위치도 함께 업데이트한다

#### `draw(self, screen)`
- 상단과 하단 파이프를 녹색으로 그린다
- 파이프 끝부분에 캡(뚜껑) 효과를 추가하여 3D 느낌을 준다
- 검은색 테두리로 파이프의 윤곽을 강조한다

#### `check_collision(self, player_rect)`
- 플레이어의 Rectangle과 파이프의 상단/하단 Rectangle 충돌 검사
- 충돌 시 True, 비충돌 시 False 반환

#### `check_passed(self, player_x)`
- 플레이어가 파이프를 통과했는지 확인한다
- 한 번만 점수가 증가하도록 `passed` 플래그로 중복 체크 방지

### main.py
게임의 메인 로직과 UI를 관리하는 핵심 파일이다.

**Game 클래스의 주요 메서드:**

#### `__init__(self, camera_index)`
- Pygame 초기화 및 게임 창 생성 (1200x800)
- 폰트 로드 (대형 64px, 중형 48px, 소형 32px)
- 게임 상태를 LOBBY로 초기화
- 플레이어 객체 생성 및 랭킹 데이터 로드

#### `load_rankings(self)`
- rankings.json 파일에서 기존 랭킹 데이터를 읽어온다
- 점수 기준 내림차순으로 정렬하여 반환
- 파일이 없거나 손상된 경우 빈 리스트 반환

#### `save_ranking(self, user_id, score)`
- 새로운 점수 기록을 랭킹에 추가한다
- 날짜/시간 정보와 함께 JSON 형식으로 저장
- 상위 10개 기록만 유지하고 나머지는 삭제

#### `draw_gradient_background(self)`
- 하늘색 그라데이션 배경을 그린다
- 위쪽은 밝은 하늘색, 아래쪽은 진한 파란색으로 자연스러운 변화

#### `draw_clouds(self)`
- 배경에 움직이는 구름 효과를 추가한다
- 여러 개의 원을 겹쳐 그려서 구름 모양 생성
- 시간에 따라 구름이 천천히 이동하는 애니메이션

#### `draw_lobby(self)`
- 게임 시작 화면을 그린다
- 제목에 글로우 효과와 펄싱 애니메이션 적용
- 5글자 ID 입력을 위한 시각적 슬롯 제공
- 입력된 글자는 녹색, 빈 슬롯은 회색으로 표시
- 우측에 상위 랭킹 표시

#### `draw_game(self)`
- 실제 게임 플레이 화면을 그린다
- 좌상단에 점수, 속도, 플레이어 정보, 포즈 상태를 박스로 표시
- 각 정보 박스는 반투명 배경과 컬러 테두리로 구분
- 하단에 조작법 안내 메시지 표시

#### `draw_gameover(self)`
- 게임 종료 화면을 그린다
- 어두운 빨간색 오버레이로 게임 오버 분위기 연출
- 최종 점수와 플레이어 정보를 크게 표시
- 점수에 따른 격려 메시지 제공 (50점 이상: 최고, 20점 이상: 잘함, 그 외: 연습 필요)
- 재시작 및 로비 이동 안내

#### `draw_fancy_rankings(self, x, y)`
- 상위 5개 랭킹을 시각적으로 표시한다
- 1-3위는 금/은/동 색상으로 특별 표시
- 각 순위별로 배경 박스와 테두리 색상 차별화
- 280x400 크기의 패널에 그라데이션 배경 적용

#### `handle_lobby_input(self, event)`
- 로비 화면에서의 키보드 입력 처리
- 백스페이스: 마지막 글자 삭제
- 엔터: 5글자 완성 시 게임 시작 및 카메라 초기화
- 영숫자: ID에 추가 (5글자 제한)

#### `handle_game_input(self, event)`
- 게임 중 키보드 입력 처리
- 스페이스: 포즈 인식 실패 시 수동 점프
- ESC: 로비로 돌아가기

#### `handle_gameover_input(self, event)`
- 게임 오버 화면에서의 입력 처리
- R: 게임 재시작
- ESC: 로비로 돌아가기

#### `spawn_pipe(self)`
- 설정된 간격(2200ms)마다 새로운 파이프 생성
- 화면 우측 끝에서 시작하여 왼쪽으로 이동

#### `update_pipes(self)`
- 모든 파이프의 위치 업데이트
- 플레이어가 파이프를 통과했는지 확인하여 점수 증가
- 파이프 통과 시 게임 속도 증가 (0.2씩)
- 화면을 벗어난 파이프는 메모리에서 제거

#### `check_collisions(self)`
- 플레이어와 파이프 간의 충돌 검사
- 화면 상하단 경계 충돌 검사
- 충돌 발생 시 True 반환하여 게임 오버 처리

#### `update_camera(self)`
- 포즈 인식 카메라 업데이트
- 인식된 포즈 정보를 별도 창에 표시
- 카메라 창을 게임 창 우측에 자동 배치

#### `run(self)`
- 메인 게임 루프 실행
- 60FPS로 화면 업데이트
- 게임 상태별 이벤트 처리 및 화면 그리기
- ESC 또는 창 닫기로 게임 종료

## 게임 조작법

1. **로비 화면**: 키보드로 5글자 ID 입력 후 엔터
2. **게임 중**: 턱걸이 동작으로 새의 높이 조절
3. **예비 조작**: 포즈 인식 실패 시 스페이스바로 점프 가능
4. **일시정지**: ESC키로 로비로 돌아가기

## 점수 시스템

- 파이프 1개 통과당 1점 획득
- 파이프 통과할 때마다 게임 속도 증가 (0.2씩)
- 최고 점수는 자동으로 JSON 파일에 저장됨
- 상위 10개 기록 유지, 화면에는 상위 5개만 표시

## 게임 화면 구성

### 로비 화면 (1200x800)
- 중앙: 게임 제목 및 ID 입력창
- 우측: TOP 5 랭킹 리스트
- 배경: 파란색 그라데이션 + 움직이는 구름

### 게임 화면
- 좌상단: 점수, 속도, 플레이어 정보, 포즈 상태
- 중앙: 게임 영역 (새 + 파이프들)
- 하단: 조작법 안내
- 우측: 실시간 카메라 피드 (별도 창)

### 게임 오버 화면
- 중앙: GAME OVER 메시지 + 최종 점수
- 하단: 재시작 및 로비 이동 안내
- 우측: 업데이트된 랭킹 리스트
- 배경: 어두운 빨간색 오버레이
